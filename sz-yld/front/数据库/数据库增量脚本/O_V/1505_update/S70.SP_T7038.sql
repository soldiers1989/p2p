DROP PROCEDURE IF EXISTS `S70`.`SP_T7038`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `S70`.`SP_T7038`(IN _date DATE)
    COMMENT '平台资金统计-按年度'
BEGIN
	-- 平台资金统计-按年度
	-- 年份
	DECLARE		_F01							INT 					UNSIGNED		DEFAULT	0;	
	-- 充值手续费
	DECLARE		_F03							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 提现手续费
	DECLARE		_F04							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 充值成本
	DECLARE		_F05							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 提现成本
	DECLARE		_F06							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 身份验证手续费
	DECLARE		_F07							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 借款管理费
	DECLARE		_F08							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 逾期管理费
	DECLARE		_F09							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 债权转让费
	DECLARE		_F10							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 活动费用
	DECLARE		_F11							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 理财管理费
	DECLARE		_F12							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 持续推广费用
	DECLARE		_F13							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 有效推广费用
	DECLARE		_F14							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 违约金手续费
	DECLARE		_F15							DECIMAL(20,2) 			 DEFAULT 	0.00;
						
	DECLARE		_startDate			DATE;
	DECLARE		_endDate				DATE;
	DECLARE		_current_date				DATE;
	SET _current_date = IFNULL(_date,CURRENT_DATE());
	SET _current_date = DATE_SUB(_current_date,INTERVAL 1 DAY);
	SET _F01 = YEAR(_current_date);
	CALL SP_YEAR_DATE(_F01,_startDate,_endDate);
	
	SELECT IFNULL(SUM(F07),0) INTO _F03  FROM S61.T6102 WHERE  F03 = '1002' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F06),0) INTO _F04  FROM S61.T6130 WHERE  F09 = 'YFK' AND F08 >= _startDate AND DATE(F08) <= _endDate;
	SELECT IFNULL(SUM(F06),0) INTO _F05  FROM S61.T6102 WHERE  F03 = '1003' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F06  FROM S61.T6102 WHERE  F03 = '2003' AND	F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F07  FROM S61.T6102 WHERE  F03 = '1501' AND	F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F06),0) INTO _F08  FROM S61.T6102 WHERE  F03 = '1201' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F09  FROM S61.T6102 WHERE  F03 = '7003' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F10  FROM S61.T6102 WHERE  F03 = '4001' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F11  FROM S61.T6102 WHERE  F03 = '8001' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F12  FROM S61.T6102 WHERE  F03 = '1202' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F13  FROM S61.T6102 WHERE  F03 = '9002' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F14  FROM S61.T6102 WHERE  F03 = '9001' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F15  FROM S61.T6102 WHERE  F03 = '7007' AND F05 >= _startDate AND DATE(F05) <= _endDate;
	INSERT INTO S70.T7038 SET F01 = _F01, F03 = _F03, F04 = _F04, F05 = _F05 ,F06 = _F06, F07 = _F07, F08 = _F08, F09 = _F09, F10 = _F10, F11 = _F11, F12 = _F12,F13 = _F13, F14 = _F14, F15 = _F15
	ON DUPLICATE KEY UPDATE F03 = VALUES(_F03) , F04 = VALUES(_F04),F05 = VALUES(_F05),F06 = VALUES(_F06) , F07 = VALUES(_F07),
	F08 = VALUES(_F08),F09 = VALUES(_F09) , F10 = VALUES(_F10), F11 = VALUES(_F11), F12 = VALUES(_F12), F13 = VALUES(_F13), F14 = VALUES(_F14), F15 = VALUES(_F15);
END
;;
DELIMITER ;