DROP PROCEDURE IF EXISTS `S70`.`SP_T7043`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `S70`.`SP_T7043`(IN _date DATE)
    COMMENT '成交数据统计-按月-按类型'
BEGIN
	-- 成交数据统计-按月-按类型	
	-- 年份
	DECLARE		_F01							INT 					UNSIGNED		DEFAULT	0;	
	-- 月份
	DECLARE		_F02							INT 					UNSIGNED		DEFAULT	0;	
	-- 成交金额
	DECLARE		_F03							DECIMAL(20,2) DEFAULT 0.00;	
	-- 成交笔数
	DECLARE		_F04							INT 					UNSIGNED		DEFAULT 0;	
	-- 类型
	DECLARE		_F05							VARCHAR(20); 
						
	DECLARE		_startDate			DATE;
	DECLARE		_endDate				DATETIME;
	DECLARE		_current_date				DATE;
	SET _current_date = IFNULL(_date,CURRENT_DATE());
	SET _current_date = DATE_SUB(_current_date,INTERVAL 1 DAY);
	SET _F01 = YEAR(_current_date);
	SET _F02 = MONTH(_current_date);
	CALL SP_MONTH_DATE(_current_date,_startDate,_endDate);
	
	SET _F05 = 'XYRZ';
	SELECT IFNULL(SUM(T6230.F05-T6230.F07),0),COUNT(T6230.F01) INTO _F03,_F04	 FROM S62.T6230 INNER JOIN S62.T6231 ON T6230.F01 = T6231.F01 WHERE T6230.F33 ='S' AND T6230.F20 IN ('YDF','YJQ','HKZ') AND T6231.F12 >= _startDate AND T6231.F12 <= _endDate;
	INSERT INTO S70.T7043 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04 ,F05 = _F05 
	ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04), F05 = VALUES(F05);

	SET _F05 = 'JGDB';
	SELECT IFNULL(SUM(T6230.F05-T6230.F07),0),COUNT(T6230.F01) INTO _F03,_F04	 FROM S62.T6230 INNER JOIN S62.T6231 ON T6230.F01 = T6231.F01 WHERE T6230.F11 ='S' AND T6230.F20 IN ('YDF','YJQ','HKZ') AND T6231.F12 >= _startDate AND T6231.F12 <= _endDate;
	INSERT INTO S70.T7043 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04 ,F05 = _F05 
	ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04), F05 = VALUES(F05);

	SET _F05 = 'SDRZ';
	SELECT IFNULL(SUM(T6230.F05-T6230.F07),0),COUNT(T6230.F01) INTO _F03,_F04	 FROM S62.T6230 INNER JOIN S62.T6231 ON T6230.F01 = T6231.F01 WHERE T6230.F14 ='S' AND T6230.F20 IN ('YDF','YJQ','HKZ') AND T6231.F12 >= _startDate AND T6231.F12 <= _endDate;
	INSERT INTO S70.T7043 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04 ,F05 = _F05 
	ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04), F05 = VALUES(F05);

	SET _F05 = 'DYRZ';
	SELECT IFNULL(SUM(T6230.F05-T6230.F07),0),COUNT(T6230.F01) INTO _F03,_F04	 FROM S62.T6230 INNER JOIN S62.T6231 ON T6230.F01 = T6231.F01 WHERE T6230.F13 ='S' AND T6230.F20 IN ('YDF','YJQ','HKZ') AND T6231.F12 >= _startDate AND T6231.F12 <= _endDate;
	INSERT INTO S70.T7043 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04 ,F05 = _F05 
	ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04), F05 = VALUES(F05);
END
;;
DELIMITER ;