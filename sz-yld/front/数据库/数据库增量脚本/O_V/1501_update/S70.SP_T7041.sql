DROP PROCEDURE IF EXISTS `S70`.`SP_T7041`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `S70`.`SP_T7041`(IN _date DATE)
   
BEGIN
	
	
	DECLARE _F01	INT	UNSIGNED	DEFAULT	0; 
	
	DECLARE _F02	INT DEFAULT 0;
	
	DECLARE _F03 	DECIMAL(20,2) DEFAULT 0.00;
	
	DECLARE _F04 	DECIMAL(20,2)	DEFAULT	0.00;        
	
	DECLARE _F05 	INT UNSIGNED	DEFAULT 0;
	
	DECLARE _F06 	INT UNSIGNED	DEFAULT 0;
	
	DECLARE		_current_date		DATE;
	DECLARE		_startDate			DATE;
	DECLARE		_endDate				DATETIME;

	SET _current_date = IFNULL(_date,CURRENT_DATE());
	SET _current_date = DATE_SUB(_current_date,INTERVAL 1 DAY);
	SET _F01 = YEAR(_current_date);
	SET _F02 = MONTH(_current_date);
	CALL SP_MONTH_DATE(_current_date,_startDate,_endDate);
	

	SELECT IFNULL(SUM(T6502.F03),0),COUNT(*) INTO _F03,_F05 FROM S65.T6501 INNER JOIN S65.T6502 ON T6501.F01 = T6502.F01 WHERE DATE(T6501.F06) <= _endDate AND DATE(T6501.F06) >= _startDate AND T6501.F03 = 'CG';

	SELECT IFNULL(SUM(T6130.F04),0),COUNT(*) INTO _F04,_F06 FROM S61.T6130 WHERE DATE(T6130.F14) <= _endDate AND DATE(T6130.F14) >= _startDate AND  T6130.F09 = 'YFK';


	INSERT INTO S70.T7041 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04, F05 = _F05, F06 = _F06 ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04),F05 = VALUES(F05),F06 = VALUES(F06);

	END
;;
DELIMITER ;