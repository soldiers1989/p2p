DROP PROCEDURE IF EXISTS `S70`.`SP_T7052`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `S70`.`SP_T7052`()
BEGIN
	-- 日期
	DECLARE _F01  VARCHAR(50) DEFAULT NULL;
	-- 注册用户数
	DECLARE _F02 INT DEFAULT 0;
	-- PC端注册用户数
	DECLARE _F03 INT DEFAULT 0;
	-- APP端注册用户数
	DECLARE _F04 INT DEFAULT 0;
	-- 微信端注册用户数
	DECLARE _F05 INT DEFAULT 0;
	-- 后台注册用户数
	DECLARE _F06 INT DEFAULT 0;
    -- 登录用户数
	DECLARE _F07 INT DEFAULT 0;
	-- 充值用户数
	DECLARE _F08 INT DEFAULT 0;
	-- 提现用户数
	DECLARE _F09 INT DEFAULT 0;
	-- 投资用户数
	DECLARE _F10 INT DEFAULT 0;
	-- 借款用户数
	DECLARE _F11 INT DEFAULT 0;
	-- 年份
  DECLARE _F13 CHAR(4) DEFAULT NULL;
	-- 季度
  DECLARE _F14 CHAR(5) DEFAULT NULL;
	-- 月份
  DECLARE _F15 CHAR(6) DEFAULT NULL;
	-- 周
  DECLARE _F16 CHAR(6) DEFAULT NULL;


	SELECT CURDATE() INTO _F01 FROM dual;	
	SELECT YEAR(_F01) INTO _F13 FROM DUAL;
  SELECT CONCAT(YEAR(_F01),QUARTER(_F01)) INTO _F14 FROM DUAL; 
  SELECT CONCAT(YEAR(_F01),MONTH(_F01)) INTO _F15 FROM DUAL;
  SELECT CONCAT(YEAR(_F01),WEEK(_F01)) INTO _F16 FROM DUAL;
	-- 注册用户数
	SELECT COUNT(1) INTO _F02 FROM S61.T6110 WHERE DATE(T6110.F09) = _F01;	 
	-- PC端注册用户数
	SELECT COUNT(1) INTO _F03 FROM S61.T6110 WHERE T6110.F08 = 'PCZC' AND DATE(T6110.F09) = _F01;	 
	-- APP端注册用户数
	SELECT COUNT(1) INTO _F04 FROM S61.T6110 WHERE T6110.F08 = 'APPZC' AND DATE(T6110.F09) = _F01;	 
	-- 微信端注册用户数
	SELECT COUNT(1) INTO _F05 FROM S61.T6110 WHERE T6110.F08 = 'WXZC' AND DATE(T6110.F09) = _F01;	
	-- 后台注册用户数
	SELECT COUNT(1) INTO _F06 FROM S61.T6110 WHERE T6110.F08 = 'HTTJ' AND DATE(T6110.F09) = _F01;	
	-- 登录用户数
	SELECT COUNT(1) INTO _F07 FROM S61.T6110 WHERE EXISTS (SELECT 1 FROM S61.T6190 WHERE T6190.F02 = T6110.F01 AND DATE(T6190.F03) = _F01);	
	-- 充值用户数
	SELECT COUNT(1) INTO _F08 FROM S61.T6110 WHERE EXISTS (SELECT 1 FROM S65.T6502 LEFT JOIN S65.T6501 ON T6502.F01 = T6501.F01 WHERE T6502.F02 = T6110.F01 AND T6502.F08 IS NOT NULL AND DATE(T6501.F06) = _F01);
	-- 提现用户数
	SELECT COUNT(DISTINCT T6503.F02) INTO _F09 FROM S65.T6503 INNER JOIN S65.T6501 ON T6503.F01 = T6501.F01 WHERE T6501.F03 = 'CG' AND DATE(T6501.F06) = _F01;
	-- 投资用户数
	SELECT COUNT(1) INTO _F10 FROM S61.T6110 WHERE EXISTS (SELECT 1 FROM S62.T6250 LEFT JOIN S62.T6231 ON T6231.F01 = T6250.F02 WHERE T6250.F03 = T6110.F01 AND T6250.F08 = 'S' AND DATE(T6231.F12) = _F01);
	-- 借款用户数
	SELECT COUNT(1) INTO _F11 FROM S61.T6110 WHERE EXISTS (SELECT 1 FROM S62.T6230 LEFT JOIN S62.T6231 ON T6231.F01 = T6230.F01 WHERE T6230.F02 = T6110.F01 AND T6230.F20 IN ('HKZ','YJQ','YDF','YZR') AND DATE(T6231.F12) = _F01);
	
    INSERT INTO S70.T7052 SET F01 = _F01, F02 = _F02, F03 = _F03, F04 = _F04, F05 = _F05, F06 = _F06, F07 = _F07, F08 = _F08, F09 = _F09, F10 = _F10, F11 = _F11, F13 = _F13, F14 = _F14, F15 = _F15, F16 = _F16 
    ON DUPLICATE KEY UPDATE F01 = VALUES(F01),F02 = VALUES(F02),F03 = VALUES(F03),F04 = VALUES(F04),F05 = VALUES(F05), F06 = VALUES(F06), F07 = VALUES(F07), F08 = VALUES(F08), F09 = VALUES(F09), F10 = VALUES(F10), F11 = VALUES(F11), F13 = VALUES(F13), F14 = VALUES(F14), F15 = VALUES(F15), F16 = VALUES(F16);

END
;;
DELIMITER ;


DROP EVENT IF EXISTS `S70`.`EVT_T7052`;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` EVENT `S70`.`EVT_T7052` ON SCHEDULE EVERY 10 SECOND STARTS '2015-12-01 00:00:01' ON COMPLETION PRESERVE ENABLE DO CALL SP_T7052()
;;
DELIMITER ;