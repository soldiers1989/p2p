ALTER TABLE `S70`.`T7038`
ADD COLUMN `F16`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '本金垫付返还',
ADD COLUMN `F17`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '利息垫付返还',
ADD COLUMN `F18`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '罚息垫付返还',
ADD COLUMN `F19`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '本金垫付支出',
ADD COLUMN `F20`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '利息垫付支出',
ADD COLUMN `F21`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '罚息垫付支出',
ADD COLUMN `F22`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '加息奖励费用',
ADD COLUMN `F23`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '体验金投资费用',
ADD COLUMN `F24`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '红包奖励费用',
ADD COLUMN `F25`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '奖励标奖励费用',
ADD COLUMN `F26`  DECIMAL(20,2) NULL DEFAULT '0.00' COMMENT '线下充值';

DELIMITER $$

USE `s70`$$

DROP PROCEDURE IF EXISTS `SP_T7038`$$

CREATE DEFINER=`root`@`%` PROCEDURE `SP_T7038`(IN _date DATE)
    COMMENT '平台资金统计-按年度'
BEGIN
	-- 平台资金统计-按年度
	-- 年份
	DECLARE		_F01							INT 					UNSIGNED		DEFAULT	0;	
	-- 充值手续费
	DECLARE		_F03							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 提现手续费
	DECLARE		_F04							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 充值成本
	DECLARE		_F05							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 提现成本
	DECLARE		_F06							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 身份验证手续费
	DECLARE		_F07							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 借款管理费
	DECLARE		_F08							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 逾期管理费
	DECLARE		_F09							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 债权转让费
	DECLARE		_F10							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 活动费用
	DECLARE		_F11							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 理财管理费
	DECLARE		_F12							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 持续推广费用
	DECLARE		_F13							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 有效推广费用
	DECLARE		_F14							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 违约金手续费
	DECLARE		_F15							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 本金垫付返还
	DECLARE		_F16							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 利息垫付返还
	DECLARE		_F17							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 罚息垫付返还
	DECLARE		_F18							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 本金垫付支出
	DECLARE		_F19							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 利息垫付支出
	DECLARE		_F20							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 罚息垫付支出
	DECLARE		_F21							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 加息奖励费用
	DECLARE		_F22							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 体验金投资费用
	DECLARE		_F23							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 红包奖励费用
	DECLARE		_F24							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 奖励标奖励费用
	DECLARE		_F25							DECIMAL(20,2) 			 DEFAULT 	0.00;
	-- 线下充值
	DECLARE		_F26							DECIMAL(20,2) 			 DEFAULT 	0.00;
						
	DECLARE		_startDate			DATE;
	DECLARE		_endDate				DATE;
	DECLARE		_current_date				DATE;
	SET _current_date = IFNULL(_date,CURRENT_DATE());
	SET _current_date = DATE_SUB(_current_date,INTERVAL 1 DAY);
	SET _F01 = YEAR(_current_date);
	CALL SP_YEAR_DATE(_F01,_startDate,_endDate);
	
	SELECT IFNULL(SUM(F07),0) INTO _F03  FROM S61.T6102 WHERE  F03 = 1002 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F06),0) INTO _F04  FROM S61.T6130 WHERE  F09 = 'YFK' AND F08 >= _startDate AND DATE(F08) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F05  FROM S61.T6102 WHERE  F03 = 1003 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F06  FROM S61.T6102 WHERE  F03 = 2003 AND	F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F07  FROM S61.T6102 WHERE  F03 = 1501 AND	F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F06),0) INTO _F08  FROM S61.T6102 WHERE  F03 = 1201 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F09  FROM S61.T6102 WHERE  F03 = 7003 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F10  FROM S61.T6102 WHERE  F03 = 4001 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F11  FROM S61.T6102 WHERE  F03 = 8001 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F12  FROM S61.T6102 WHERE  F03 = 1202 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F13  FROM S61.T6102 WHERE  F03 = 9002 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F14  FROM S61.T6102 WHERE  F03 = 9001 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F15  FROM S61.T6102 WHERE  F03 = 7007 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(T6253.F06),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05=7001 AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(T6253.F06),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05=7002 AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(T6253.F06),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05 IN (7003,7004) AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(T6253.F05),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05=7001 AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(T6253.F05),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05=7002 AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(T6253.F05),0) INTO _F21 FROM S62.T6253 JOIN S62.T6255 ON T6253.F01=T6255.F02 WHERE T6255.F05 IN (7003,7004) AND T6253.F07 >= _startDate AND DATE(T6253.F07) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F22  FROM S61.T6102 WHERE  F03 = 7010 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F23  FROM S61.T6102 WHERE  F03 = 3003 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F24  FROM S61.T6102 WHERE  F03 = 7009 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F25  FROM S61.T6102 WHERE  F03 = 7008 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	SELECT IFNULL(SUM(F07),0) INTO _F26  FROM S61.T6102 WHERE  F03 = 1004 AND F05 >= _startDate AND DATE(F05) <= _endDate;
	
	INSERT INTO S70.T7038 SET F01 = _F01, F03 = _F03, F04 = _F04, F05 = _F05 ,F06 = _F06, F07 = _F07, F08 = _F08, F09 = _F09, F10 = _F10, F11 = _F11, F12 = _F12,F13 = _F13, F14 = _F14, F15 = _F15, 
	F16 = _F16, F17 = _F17, F18 = _F18, F19 = _F19, F20 = _F20, F21 = _F21, F22 = _F22, F23 = _F23, F24 = _F24, F25 = _F25, F26 = _F26 
	ON DUPLICATE KEY UPDATE F03 = VALUES(F03) , F04 = VALUES(F04),F05 = VALUES(F05),F06 = VALUES(F06) , F07 = VALUES(F07),
	F08 = VALUES(F08),F09 = VALUES(F09) , F10 = VALUES(F10), F11 = VALUES(F11), F12 = VALUES(F12), F13 = VALUES(F13), F14 = VALUES(F14), 
	F15 = VALUES(F15), F16 = VALUES(F16), F17 = VALUES(F17), F18 = VALUES(F18), F19 = VALUES(F19), F20 = VALUES(F20), F21 = VALUES(F21), 
	F22 = VALUES(F22), F23 = VALUES(F23), F24 = VALUES(F24), F25 = VALUES(F25), F26 = VALUES(F26);
END$$

DELIMITER ;
