DROP PROCEDURE IF EXISTS `S64`.`SP_T6413`;
DELIMITER ;;
CREATE DEFINER=`root`@`%` PROCEDURE `S64`.`SP_T6413`()
BEGIN
			DECLARE _F01 	INT        DEFAULT 0;
			DECLARE _F02	DECIMAL(20,2) DEFAULT 0.00;
			DECLARE _F03	DECIMAL(20,2) DEFAULT 0.00;
			DECLARE _F04 	DECIMAL(20,2) DEFAULT 0.00;
			DECLARE _F05 	INT	UNSIGNED	DEFAULT	0;         
			DECLARE _F06 	DECIMAL(20,2) 	DEFAULT 0.000;
			DECLARE _F07  DECIMAL(20,2) DEFAULT 0.00;
			DECLARE _ACCOUNTID 	INT   DEFAULT 0;
			DECLARE _TOTAL_RATE  DECIMAL(20,2) DEFAULT 0.00;
			DECLARE _DONE								INT UNSIGNED		DEFAULT	0;
			DECLARE _CURSOR CURSOR FOR SELECT DISTINCT F03 FROM S64.T6411;
			DECLARE CONTINUE HANDLER FOR NOT FOUND SET _DONE = 1;

			OPEN _CURSOR;
			REPEAT 
				FETCH _CURSOR INTO _F01;
				IF NOT _DONE THEN	
					BEGIN
							SELECT IFNULL(SUM(F07),0)	 INTO _F02  FROM S64.T6412 WHERE F09 = 'YH' AND F04=_F01 AND F05=7002;
							SELECT IFNULL(SUM(F05),0) INTO _F03 FROM S64.T6411 WHERE F03=_F01;
							SELECT IFNULL(SUM(T6410.F05),0) INTO _TOTAL_RATE FROM T6411 INNER JOIN T6410 ON T6411.F02=T6410.F01 WHERE T6411.F03=_F01 AND (T6410.F07 = 'YSX' OR T6410.F07 = 'YJZ');
							SELECT IFNULL(COUNT(),0) INTO _F05 FROM S64.T6411 WHERE F03=_F01;
							SET _F04 =IFNULL(_TOTAL_RATE_F05,0);
							SELECT F01 			INTO _ACCOUNTID FROM S61.T6101 WHERE F02=_F01 AND F03='WLZH';
							SELECT IFNULL(SUM(F07),0) INTO _F06 FROM S61.T6102 WHERE F02=_ACCOUNTID AND F03=1302;
							SELECT IFNULL(SUM(F04),0) INTO _F07 FROM S64.T6411 WHERE F03=_F01;
							UPDATE S64.T6413 SET F02 = _F02, F03 = _F03, F04 = _F04, F05 = _F05,F06=_F06 ,F07=_F07 WHERE F01=_F01;
					END;
				END IF;
			UNTIL _DONE	END REPEAT;
			CLOSE _CURSOR;
END
;;
DELIMITER ;